<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- This file has been generated by Salto-db Generator Ant v1.0.15 / Hibernate pojos and xml mapping files. at Sat Feb 06 09:46:36 EST 2010 -->
<hibernate-mapping>
 <class name="net.aegis.lab.dao.pojo.Caseresult" table="caseresult">
  <id name="resultId">
   <generator class="native"/>
  </id>
  <many-to-one column="caseExecutionId" name="caseexecution"/>
  <property column="executeTime" generated="never" lazy="false" name="executeTime"/>
  <property column="labInd" generated="never" lazy="false" name="labInd"/>
  <property column="result" generated="never" lazy="false" name="result"/>
  <property column="resultInfo" generated="never" lazy="false" name="resultInfo"/>
  <property column="documentIds" generated="never" lazy="false" name="documentIds"/>
  <property column="labDocumentIds" generated="never" lazy="false" name="labDocumentIds"/>
  <property column="submissionInd" generated="never" lazy="false" name="submissionInd"/>
  <property column="message" generated="never" lazy="false" name="message"/>
  <property column="errorCode" generated="never" lazy="false" name="errorCode"/>
  <property column="stacktrace" generated="never" lazy="false" name="stacktrace"/>
  <property name="processedRIsCount" column="processedRIsCount"/>
  <property name="createdAt" column="createdAt" />
  <property name="createdBy" column="createdBy" />
  <property name="updatedAt" column="updatedAt" />
  <property name="updatedBy" column="updatedBy" />
  
  <bag inverse="true" name="attachments">
   <key column="resultId"/>
   <one-to-many class="net.aegis.lab.dao.pojo.Attachment"/>
  </bag>
  <bag cascade="delete" inverse="true" name="auditsummarys">
   <key column="resultId"/>
   <one-to-many class="net.aegis.lab.dao.pojo.Auditsummary"/>
  </bag>
  <bag inverse="true" name="caseresultparameterss">
   <key column="resultId"/>
   <one-to-many class="net.aegis.lab.dao.pojo.Caseresultparameters"/>
  </bag>
  <bag name="patientcorrelations" inverse="true">
	<key column="resultId"/>
	<one-to-many class="net.aegis.lab.dao.pojo.Patientcorrelation"/>
  </bag>
  <bag inverse="true" name="resultdocuments">
   <key column="resultId"/>
   <one-to-many class="net.aegis.lab.dao.pojo.Resultdocument"/>
  </bag>
  <bag inverse="true" name="resultsummarys">
   <key column="resultId"/>
   <one-to-many class="net.aegis.lab.dao.pojo.Resultsummary"/>
  </bag>
  
 </class>
 <!--  This is not a reliable way to get latest case result as we sometimes have two records with the same executeTime (tracked up to the second only)
            for the same caseExecutionId.  Use findByExecIdAndMaxResultId instead -->
 <query name="Caseresult.findByExecIdAndMaxExecTime">from Caseresult c where c.caseexecution.caseExecutionId = :caseExecutionId and c.executeTime = (select max(cc.executeTime) from Caseresult cc where cc.caseexecution.caseExecutionId = :caseExecutionId)</query>
 <query name="Caseresult.findByExecIdAndMaxResultId">from Caseresult c where c.caseexecution.caseExecutionId = :caseExecutionId and c.resultId = (select max(cc.resultId) from Caseresult cc where cc.caseexecution.caseExecutionId = :caseExecutionId)</query>
 <query name="Caseresult.findByParticipantForActivePassInitiator">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and cr.result = 'PASS'
           and tc.initiatorInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassResponder">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and cr.result = 'PASS'
           and tc.responderInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassPDI">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and ce.messageType = 'PD'
           and cr.result = 'PASS'
           and tc.initiatorInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassPDR">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and ce.messageType = 'PD'
           and cr.result = 'PASS'
           and tc.responderInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassQDI">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and ce.messageType = 'QD'
           and cr.result = 'PASS'
           and tc.initiatorInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassQDR">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and ce.messageType = 'QD'
           and cr.result = 'PASS'
           and tc.responderInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassRDI">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and ce.messageType = 'RD'
           and cr.result = 'PASS'
           and tc.initiatorInd = 'Y'
         order by cr.resultId desc</query>
 <query name="Caseresult.findByParticipantForActivePassRDR">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from Scenarioexecution se, Caseexecution ce, Caseresult cr, Testcase tc
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.participant.participantId = :participantId
           and se.status = 'ACTIVE'
           and ce.messageType = 'RD'
           and cr.result = 'PASS'
           and tc.responderInd = 'Y'
         order by cr.resultId desc</query>
  <query name="Caseresult.findMaxCaseresultForTestCase">select cr.resultId, cr.caseexecution.caseExecutionId, cr.executeTime, cr.labInd, cr.result, cr.resultInfo, cr.documentIds, cr.labDocumentIds, cr.submissionInd, cr.message
          from  Caseexecution ce, Scenarioexecution se, Caseresult cr, Testcase tc 
         where se.scenarioExecutionId = ce.scenarioexecution.scenarioExecutionId
           and ce.caseExecutionId = cr.caseexecution.caseExecutionId
           and ce.testcase.caseId = tc.caseId
           and se.scenario.scenarioId=:scenarioId         
           and se.participant.participantId = :participantId                    
           and tc.caseId=:caseId
           and se.status = 'ACTIVE'
           and cr.result = 'PASS' 
           order by cr.resultId desc</query>
         
</hibernate-mapping>
